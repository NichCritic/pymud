'''
Created on 2013-11-17

@author: Nich
'''
 
from PyMud.objects.baseobject import Entity
from PyMud.objects.node_factory import NodeFactoryDB
from PyMud.room.room import RoomFactory, LocationFactory
from PyMud.room.room_components import Link
from PyMud.objects.component_manager import ComponentManager
from PyMud.objects.components import components
from PyMud.room.room_components import components as room_components



def create_test_room(comp_manager, node_factory):
    #|0|   ____
    #|||  / 0  \
    #|||_// | \ \   N
    #|0-_0 -0- 0| W   E
    #||| \\ | / /   S
    #|||  \_0__/
    #|0| 
    
    all_components = {}
    all_components.update(components)
    all_components.update(room_components)
    
    
    
    room_factory = RoomFactory(comp_manager)
    location_factory = LocationFactory(comp_manager)
    
    hallway = room_factory.create_room()
    hall_node = node_factory.create_node(hallway.id, ["locations",])
    hall_n = hall_node.locations.add_location(location_factory.create_location())
    hall_m = hall_node.locations.add_location(location_factory.create_location())
    hall_s = hall_node.locations.add_location(location_factory.create_location())
    
    hall_n_node = node_factory.create_node(hall_n.id, ["description","node"])
    hall_m_node = node_factory.create_node(hall_m.id, ["description","node"])
    hall_s_node = node_factory.create_node(hall_s.id, ["description","node"])
    
    hall_n_node.description.name = "north"
    hall_m_node.description.name = "middle"
    hall_s_node.description.name = "south"
    
    Link(hall_n_node, hall_m_node)
    Link(hall_m_node, hall_s_node)
    
    
    gryffindore_common_room = room_factory.create_room()
    gcr_node = node_factory.create_node(gryffindore_common_room.id, ["locations"])
    gcr_n = gcr_node.locations.add_location(location_factory.create_location())
    gcr_e = gcr_node.locations.add_location(location_factory.create_location())
    gcr_w = gcr_node.locations.add_location(location_factory.create_location())
    gcr_s = gcr_node.locations.add_location(location_factory.create_location())
    gcr_m = gcr_node.locations.add_location(location_factory.create_location())
    
    gcr_n_node = node_factory.create_node(gcr_n.id, ["description","location", "node", "objects"])
    gcr_e_node = node_factory.create_node(gcr_e.id, ["description","location", "node", "objects"])
    gcr_s_node = node_factory.create_node(gcr_s.id, ["description","location", "node", "objects"])
    gcr_w_node = node_factory.create_node(gcr_w.id, ["description","location", "node", "objects"])
    gcr_m_node = node_factory.create_node(gcr_m.id, ["description","location", "node", "objects"])
    
    
    gcr_n_node.description.name = "north"
    gcr_n_node.location.x = 9
    gcr_n_node.location.y = 3
    gcr_n_node.location.room = gryffindore_common_room.id
    
    gcr_e_node.description.name = "east"
    
    gcr_e_node.location.x = 16
    gcr_e_node.location.y = 9
    gcr_e_node.location.room = gryffindore_common_room.id
    
    gcr_s_node.description.name = "south"
    
    gcr_s_node.location.x = 9
    gcr_s_node.location.y = 15
    gcr_s_node.location.room = gryffindore_common_room.id
    
    
    gcr_w_node.description.name = "west"
    
    gcr_w_node.location.x = 2
    gcr_w_node.location.y = 9
    gcr_w_node.location.room = gryffindore_common_room.id
    
    gcr_m_node.description.name = "middle"
    
    gcr_m_node.location.x = 9
    gcr_m_node.location.y = 9
    gcr_m_node.location.room = gryffindore_common_room.id
    
    
    
    Link(gcr_n_node, gcr_m_node)
    Link(gcr_n_node, gcr_e_node)
    Link(gcr_n_node, gcr_w_node)
    Link(gcr_e_node, gcr_m_node)
    Link(gcr_e_node, gcr_s_node)
    Link(gcr_w_node, gcr_m_node)
    Link(gcr_w_node, gcr_s_node)
    Link(gcr_s_node, gcr_m_node)
    
    
    chair1 = comp_manager.create_entity({
                                         "names": {"name":"chair1", "aliases":["chair"]},
                                         "description":{"description":"A simple chair"},
                                         "type":{"type":"chair1"},
                                         "location": {"location":gcr_n.id, "room":gryffindore_common_room.id},
                                         
                                         })
   
    gcr_n_node.objects.add_object(chair1)
    import math
    chair2 = comp_manager.create_entity({
                                         "names": {"name":"chair2", "aliases":["chair"]},
                                         "description":{"description":"A simple chair"},
                                         "type":{"type":"chair2"},
                                         "location": {"location":gcr_w.id, "room":gryffindore_common_room.id, "x":math.sqrt(3), "y":math.sqrt(3), "z":math.sqrt(3)},
                                         
                                         })
   
    gcr_w_node.objects.add_object(chair2)
    
    
    
    
    return gryffindore_common_room, gcr_n, chair1, chair2, node_factory